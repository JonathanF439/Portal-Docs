// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Tipos de função dos usuários no sistema
enum UserRole {
  ADMIN     // Administrador do sistema
  SUPPLIER  // Fornecedor/Empresa
}

// Status dos documentos enviados
enum DocumentStatus {
  PENDING   // Aguardando análise
  APPROVED  // Aprovado pelo admin
  REJECTED  // Reprovado pelo admin
}

// Status do cadastro da empresa
enum CompanyStatus {
  PENDING   // Aguardando liberação de acesso
  ACTIVE    // Cadastro aprovado, pode acessar o sistema
  REJECTED  // Cadastro recusado
}


model Company {
  id           String        @id @default(uuid())
  cnpj         String        @unique // CNPJ único da empresa
  fantasyName  String        // Nome fantasia
  socialReason String        // Razão social
  zipCode      String        // CEP
  address      String        // Logradouro
  number       String        // Número
  complement   String?       // Complemento (opcional)
  neighborhood String        // Bairro
  city         String        // Cidade
  state        String        // UF (Estado)
  phone        String        // Telefone de contato
  status       CompanyStatus @default(PENDING) // Status inicial: aguardando aprovação
  createdAt    DateTime      @default(now())   // Data de criação do cadastro
  updatedAt    DateTime      @updatedAt        // Data da última atualização

  // Relacionamentos
  users     User[]     // Usuários vinculados a esta empresa
  documents Document[] // Documentos enviados por esta empresa

  @@map("companies") // Nome da tabela no banco
}


model User {
  id        String   @id @default(uuid())
  name      String   // Nome completo do usuário
  email     String   @unique // Email único para login
  password  String   // Senha criptografada (bcrypt)
  role      UserRole // Papel do usuário (ADMIN ou SUPPLIER)
  companyId String?  // ID da empresa (null para admins)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  company   Company?   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  documents Document[] // Documentos enviados por este usuário

  @@map("users")
}


model Document {
  id              String         @id @default(uuid())
  name            String         // Nome/Descrição do documento
  fileType        String         // Tipo do arquivo (pdf, jpg, png)
  fileUrl         String         // URL ou caminho do arquivo armazenado
  status          DocumentStatus @default(PENDING) // Status inicial: pendente
  rejectionReason String?        // Motivo da reprovação (se aplicável)
  uploadedAt      DateTime       @default(now())   // Data do upload
  updatedAt       DateTime       @updatedAt        // Data da última atualização
  
  // Chaves estrangeiras
  userId    String // ID do usuário que enviou
  companyId String // ID da empresa dona do documento

  // Relacionamentos
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("documents")
}